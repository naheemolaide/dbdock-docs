---
title: 'Configuration'
description: 'Configure DBdocks via dbdock.config.json'
---

The `dbdock.config.json` file controls all aspects of DBdocks. It is automatically generated by `npx dbdock init` but can be edited manually.

## Structure

```json
{
  "database": { ... },
  "storage": { ... },
  "backup": { ... },
  "alerts": { ... }
}
```

## Database

Configuration for connecting to your PostgreSQL database.

```json
"database": {
  "type": "postgres",
  "host": "localhost",
  "port": 5432,
  "username": "postgres",
  "password": "your-password",
  "database": "myapp"
}
```

## Storage

DBDock supports multiple storage providers.

### Local

Stores backups on the local filesystem.

```json
"storage": {
  "provider": "local",
  "local": {
    "path": "./backups"
  }
}
```

### AWS S3

Stores backups in an Amazon S3 bucket.

```json
"storage": {
  "provider": "s3",
  "s3": {
    "bucket": "my-backups",
    "region": "us-east-1",
    "accessKeyId": "YOUR_ACCESS_KEY",
    "secretAccessKey": "YOUR_SECRET_KEY"
  }
}
```

### Cloudflare R2

Stores backups in Cloudflare R2.

```json
"storage": {
  "provider": "r2",
  "s3": {
    "bucket": "my-backups",
    "region": "auto",
    "endpoint": "https://ACCOUNT_ID.r2.cloudflarestorage.com",
    "accessKeyId": "YOUR_ACCESS_KEY",
    "secretAccessKey": "YOUR_SECRET_KEY"
  }
}
```

### Cloudinary

Stores backups in Cloudinary.

```json
"storage": {
  "provider": "cloudinary",
  "cloudinary": {
    "cloudName": "your-cloud",
    "apiKey": "YOUR_API_KEY",
    "apiSecret": "YOUR_API_SECRET"
  }
}
```

## Backup Settings

Control how backups are created and retained.

```json
"backup": {
  "format": "custom",
  "compression": {
    "enabled": true,
    "level": 6
  },
  "encryption": {
    "enabled": true,
    "key": "64-character-hex-key..."
  },
  "retention": {
    "enabled": true,
    "maxBackups": 100,
    "maxAgeDays": 30,
    "minBackups": 5,
    "runAfterBackup": true
  }
}
```

### Backup Formats

DBDock supports multiple PostgreSQL backup formats:

- `custom` (default) - PostgreSQL custom binary format (.sql)
- `plain` - Plain SQL text format (.sql)
- `directory` - Directory format (.dir)
- `tar` - Tar archive format (.tar)

### Encryption Key

Generate a secure 64-character hexadecimal encryption key:

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

The key must be exactly 64 hexadecimal characters (0-9, a-f, A-F).

### Retention Policy

Automatic cleanup to prevent storage bloat from frequent backups.

**How it works:**
- Keeps most recent `minBackups` (safety net, never deleted)
- Deletes backups exceeding `maxBackups` limit (oldest first)
- Deletes backups older than `maxAgeDays` (respecting minBackups)
- Runs automatically after each backup (if `runAfterBackup: true`)
- Manual cleanup: `npx dbdock cleanup`

**Configuration:**
- **maxBackups**: Maximum number of backups to keep.
- **maxAgeDays**: Delete backups older than this many days.
- **minBackups**: Always keep at least this many recent backups, regardless of age.
- **runAfterBackup**: If true, cleanup runs automatically after every successful backup.

**Safety features:**
- Always preserves `minBackups` most recent backups
- Shows preview before deletion
- Detailed logging of what was deleted
- Error handling for failed deletions

## Alerts

Configure email notifications for backup events.

```json
"alerts": {
  "email": {
    "enabled": true,
    "smtp": {
      "host": "smtp.gmail.com",
      "port": 587,
      "secure": false,
      "auth": {
        "user": "your-email@gmail.com",
        "pass": "your-app-password"
      }
    },
    "from": "backups@yourapp.com",
    "to": ["admin@yourapp.com"]
  }
}
```

## Storage Permissions

### AWS S3

Required IAM permissions for S3 storage:
- `s3:PutObject` - Upload backups
- `s3:GetObject` - Download backups
- `s3:ListBucket` - List available backups
- `s3:DeleteObject` - Delete old backups

All cloud backups are stored in the `dbdock_backups/` folder with format: `backup-YYYY-MM-DD-HH-MM-SS-BACKUPID.sql`

